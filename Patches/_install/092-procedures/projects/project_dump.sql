if object_id('project_dump') is not null drop proc project_dump
go
create proc [dbo].[project_dump]
	@project_id int,
	@dump_id varchar(32)
as
begin

	set nocount on;
	
	--INSERT INTO DUMP_PROJECTS(
	--	DUMP_ID, PROJECT_ID, GROUP_ID, NAME, GOAL, CURATOR_ID, ADMIN_ID, CHIEF_ID, D_FROM, D_TO, D_TO_MIN, STATUS_ID, NOTE, PROGRESS, PROGRESS_CRITICAL, PROGRESS_EXEC, PROGRESS_SPEED, PROGRESS_LAG, ADD_DATE, UPDATE_DATE, UPDATE_MOL_ID, D_TO_FORECAST
	--	)
	--SELECT 
	--	@DUMP_ID, PROJECT_ID, GROUP_ID, NAME, GOAL, CURATOR_ID, ADMIN_ID, CHIEF_ID, D_FROM, D_TO, D_TO_MIN, STATUS_ID, NOTE, PROGRESS, PROGRESS_CRITICAL, PROGRESS_EXEC, PROGRESS_SPEED, PROGRESS_LAG, ADD_DATE, UPDATE_DATE, UPDATE_MOL_ID, D_TO_FORECAST
	--FROM PROJECTS WHERE PROJECT_ID = @PROJECT_ID
	
	--INSERT INTO DUMP_PROJECTS_TASKS(
	--	DUMP_ID, PROJECT_ID, PARENT_ID, TASK_ID, STATUS_ID, TASK_NUMBER, NAME, D_FROM, D_TO, BASE_D_FROM, BASE_D_TO, DURATION, PROGRESS, PREDECESSORS, HAS_CHILDS, DESCRIPTION, SORT_ID, IS_CRITICAL, ADD_DATE, UPDATE_DATE, UPDATE_MOL_ID, COUNT_CHECKS, COUNT_CHECKS_ALL, PRIORITY_ID, OUTLINE_LEVEL, D_AFTER, TAGS, IS_LONG, DURATION_BUFFER, EXECUTE_LEVEL, HAS_FILES, D_BEFORE, IS_NODE, RESERVED
	--	)
	--SELECT 
	--	@DUMP_ID, PROJECT_ID, PARENT_ID, TASK_ID, STATUS_ID, TASK_NUMBER, NAME, D_FROM, D_TO, BASE_D_FROM, BASE_D_TO, DURATION, PROGRESS, PREDECESSORS, HAS_CHILDS, DESCRIPTION, SORT_ID, IS_CRITICAL, ADD_DATE, UPDATE_DATE, UPDATE_MOL_ID, COUNT_CHECKS, COUNT_CHECKS_ALL, PRIORITY_ID, OUTLINE_LEVEL, D_AFTER, TAGS, IS_LONG, DURATION_BUFFER, EXECUTE_LEVEL, HAS_FILES, D_BEFORE, IS_NODE, RESERVED
	--FROM PROJECTS_TASKS WHERE PROJECT_ID = @PROJECT_ID

	--INSERT INTO DUMP_PROJECTS_TASKS_LINKS(
	--	DUMP_ID, PROJECT_ID, SOURCE_ID, TARGET_ID, TYPE_ID
	--	)
	--SELECT 
	--	@DUMP_ID, PROJECT_ID, SOURCE_ID, TARGET_ID, TYPE_ID
	--FROM PROJECTS_TASKS_LINKS WHERE PROJECT_ID = @PROJECT_ID
	
end
go

-- clear dump
create proc [dbo].[project_dump];10
	@project_id int,
	@dump_id varchar(32)
as
begin

	set nocount on;

	delete from dump_projects where project_id = @project_id and dump_id = @dump_id
	delete from dump_projects_tasks where project_id = @project_id and dump_id = @dump_id
	delete from dump_projects_tasks_links where project_id = @project_id and dump_id = @dump_id

end
go
